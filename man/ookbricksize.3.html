<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of OOKBRICKSIZE</TITLE>
</HEAD><BODY>
<H1>OOKBRICKSIZE</H1>
Section: Ook Programmer's Manual (3)<BR>Updated: 2013-10-03<BR><A HREF="#index">Index</A>
<A HREF="../index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

ookbricksize - reports the size of the given brick.
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<PRE>
<B>#include &lt;<A HREF="file:///usr/include/errno.h">errno.h</A>&gt;</B>
<B>#include &lt;<A HREF="file:///usr/include/ook.h">ook.h</A>&gt;</B>

<B>void ookbricksize(const struct ookfile* </B><I>of</I><B>, const size_t </B><I>id</I><B>, </B>
<B>                  size_t </B><I>bsize</I><B>[3]);</B>
</PRE>

<P>
<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<P>

<B>ookbricksize</B>()

reports the brick size for the given brick.  The
<I>bsize</I>

argument is filled with the number of voxels the brick contains.
<P>

It is rare for all bricks in a dataset to be uniformly sized.  If the
brick size does not evenly divide the domain size, a dataset will end
up with partial bricks.  Therefore, it is necessary to query the brick
size of each brick in order to ensure you do not read too much data out
of it.
<P>
<A NAME="lbAE">&nbsp;</A>
<H2>RETURN VALUE</H2>

<B>ookbricksize</B>()

technically returns nothing.  Instead, it fills the
<I>bsize</I>

argument.  On error,
<I>errno</I>

is set and the contents of
<I>bsize</I>

are undefined.
<P>
<A NAME="lbAF">&nbsp;</A>
<H2>ERRORS</H2>

<DL COMPACT>
<DT><B>EINVAL</B>

<DD>
The given
<I>of</I>

pointer does not point to a valid
<I>struct&nbsp;ookfile</I>

pointer, or
<I>id</I>

is not a valid brick index.
<P>
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>EXAMPLE</H2>

<P>

The following C99 function reports the
<B>voxel</B>

indices which satisfy the passed predicate.  The input data is assumed to be
single-component
<B>uint16_t</B>

data.
<PRE>

typedef bool (predicate)(const uint16_t);
void
search(const struct ookfile* of, predicate* p)
{
  size_t mbs[3];
  ookmaxbricksize(of, mbs);

  uint16_t* data = malloc(sizeof(uint16_t) * mbs[0]*mbs[1]*mbs[2]);

  size_t layout[3];
  size_t bid[3];
  size_t bsize[3];
  ookbricks3(of, layout);

  uint64_t nvoxels[3]; /* total number of voxels in dataset */
  ookdimensions(of, nvoxels);

  /* 3D loop to iterate over all bricks. */
  for(bid[2] = 0; bid[2] &lt; layout[2]; ++bid[2]) {
    for(bid[1] = 0; bid[1] &lt; layout[1]; ++bid[1]) {
      for(bid[0] = 0; bid[0] &lt; layout[0]; ++bid[0]) {
        ookbricksize3(of, bid, bsize);
        ookbrick3(of, bid, data);

        /* 3D loop to iterate over every voxel in a brick. */
        for(size_t z=0; z &lt; bsize[2]; ++z) {
          for(size_t y=0; y &lt; bsize[1]; ++y) {
            for(size_t x=0; x &lt; bsize[0]; ++x) {
              const size_t i = z*bsize[1]*bsize[0] + y*bsize[0] + x;
              if(p(data[i])) {
                /* need the index within the dataset, not brick */
                const size_t vi[3] = { /* voxel index */
                  (mbs[0] * bid[0]) + x,
                  (mbs[1] * bid[1]) + y,
                  (mbs[2] * bid[2]) + z
                };
                printf(&quot;voxel @ {%lu,%lu,%lu} passes,
                       vi[0], vi[1], vi[2]);
              }
            }
          }
        }
      }
    }
  }
  free(data);
}
</PRE>

<P>
<A NAME="lbAH">&nbsp;</A>
<H2>SEE ALSO</H2>

<P>
<B><A HREF="/man/ookmaxbricksize.3.html">ookmaxbricksize</A></B>(3),

<B><A HREF="/man/ookread.3.html">ookread</A></B>(3),

<B><A HREF="/man/ookcreate.3.html">ookcreate</A></B>(3)

<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">RETURN VALUE</A><DD>
<DT><A HREF="#lbAF">ERRORS</A><DD>
<DT><A HREF="#lbAG">EXAMPLE</A><DD>
<DT><A HREF="#lbAH">SEE ALSO</A><DD>
</DL>
<HR>
This document was created by
<A HREF="http://tfogal.github.io/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 02:54:01 GMT, October 08, 2013
</BODY>
</HTML>
